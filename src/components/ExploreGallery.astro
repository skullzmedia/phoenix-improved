---
import { Image } from 'astro:assets';

import amenity1 from "../assets/gallery/amenities/1.jpg";
import amenity2 from "../assets/gallery/amenities/2.jpg";
import amenity3 from "../assets/gallery/amenities/3.jpg";
import amenity4 from "../assets/gallery/amenities/4.jpg";

import gaming1 from "../assets/gallery/gaming/1.jpg";
import gaming2 from "../assets/gallery/gaming/2.jpg";
import gaming3 from "../assets/gallery/gaming/3.jpg";
import gaming4 from "../assets/gallery/gaming/4.jpg";
import gaming5 from "../assets/gallery/gaming/5.jpg";

import entertainment1 from "../assets/gallery/entertainment/1.jpg";
import entertainment2 from "../assets/gallery/entertainment/2.jpg";
import entertainment3 from "../assets/gallery/entertainment/3.jpg";
import entertainment4 from "../assets/gallery/entertainment/4.jpg";
import entertainment5 from "../assets/gallery/entertainment/5.jpg";

import ambiance1 from "../assets/gallery/ambiance/1.jpg";
import ambiance2 from "../assets/gallery/ambiance/2.jpg";
import ambiance3 from "../assets/gallery/ambiance/3.jpg";
import ambiance4 from "../assets/gallery/ambiance/4.jpg";

import food1 from "../assets/gallery/food-and-drinks/1.jpg";
import food2 from "../assets/gallery/food-and-drinks/2.jpg";
import food3 from "../assets/gallery/food-and-drinks/3.jpg";
import food4 from "../assets/gallery/food-and-drinks/4.jpg";
import food5 from "../assets/gallery/food-and-drinks/5.jpg";
import food6 from "../assets/gallery/food-and-drinks/6.jpg";
import food7 from "../assets/gallery/food-and-drinks/7.jpg";

import celebrities1 from "../assets/gallery/celebrities/1.jpg";
import celebrities2 from "../assets/gallery/celebrities/2.jpg";
import celebrities3 from "../assets/gallery/celebrities/3.jpg";
import celebrities4 from "../assets/gallery/celebrities/4.jpg";
import celebrities5 from "../assets/gallery/celebrities/5.jpg";
import celebrities6 from "../assets/gallery/celebrities/6.jpg";
import celebrities7 from "../assets/gallery/celebrities/7.jpg";
import celebrities8 from "../assets/gallery/celebrities/8.jpg";
import celebrities9 from "../assets/gallery/celebrities/9.jpg";
import celebrities10 from "../assets/gallery/celebrities/10.jpg";
import celebrities11 from "../assets/gallery/celebrities/11.jpg";
import celebrities12 from "../assets/gallery/celebrities/12.jpg";
import celebrities13 from "../assets/gallery/celebrities/13.jpg";

const categories = [
  { id: 'all', label: 'All' },
  { id: 'gaming', label: 'Gaming' },
  { id: 'entertainment', label: 'Entertainment' },
  { id: 'ambiance', label: 'Ambiance' },
  { id: 'food', label: 'Food' },
  { id: 'celebrities', label: 'Celebrities' },
  { id: 'amenities', label: 'Amenities' }
];

const galleryItems = [
  // Amenities
  { image: amenity1, alt: "Luxury Amenities", width: 800, height: 1000, category: "amenities" },
  { image: amenity2, alt: "VIP Lounge", width: 800, height: 1000, category: "amenities" },
  { image: amenity3, alt: "Private Suites", width: 800, height: 1000, category: "amenities" },
  { image: amenity4, alt: "Premium Services", width: 800, height: 1000, category: "amenities" },

  // Gaming
  { image: gaming1, alt: "Slot Machines", width: 800, height: 1000, category: "gaming" },
  { image: gaming2, alt: "Poker Tables", width: 800, height: 1000, category: "gaming" },
  { image: gaming3, alt: "Roulette Wheel", width: 800, height: 1000, category: "gaming" },
  { image: gaming4, alt: "Blackjack Table", width: 800, height: 1000, category: "gaming" },
  { image: gaming5, alt: "Chip Stacks", width: 800, height: 1000, category: "gaming" },

  // Entertainment
  { image: entertainment1, alt: "Live Band", width: 800, height: 1000, category: "entertainment" },
  { image: entertainment2, alt: "DJ Performance", width: 800, height: 1000, category: "entertainment" },
  { image: entertainment3, alt: "Stage Show", width: 800, height: 1000, category: "entertainment" },
  { image: entertainment4, alt: "Dance Floor", width: 800, height: 1000, category: "entertainment" },
  { image: entertainment5, alt: "Nightlife", width: 800, height: 1000, category: "entertainment" },

  // Ambiance
  { image: ambiance1, alt: "Lobby View", width: 800, height: 1000, category: "ambiance" },
  { image: ambiance2, alt: "Chandeliers", width: 800, height: 1000, category: "ambiance" },
  { image: ambiance3, alt: "Bar Area", width: 800, height: 1000, category: "ambiance" },
  { image: ambiance4, alt: "Interior Design", width: 800, height: 1000, category: "ambiance" },

  // Food & Drinks
  { image: food1, alt: "Gourmet Dishes", width: 800, height: 1000, category: "food" },
  { image: food2, alt: "Cocktail Bar", width: 800, height: 1000, category: "food" },
  { image: food3, alt: "Dessert Spread", width: 800, height: 1000, category: "food" },
  { image: food4, alt: "Wine Selection", width: 800, height: 1000, category: "food" },
  { image: food5, alt: "Chef's Special", width: 800, height: 1000, category: "food" },
  { image: food6, alt: "Appetizers", width: 800, height: 1000, category: "food" },
  { image: food7, alt: "Buffet Setup", width: 800, height: 1000, category: "food" },

  // Celebrities
  { image: celebrities1, alt: "Celebrity Appearance", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities2, alt: "Star Guest", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities3, alt: "VIP Entry", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities4, alt: "Red Carpet", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities5, alt: "Celebrity Meet", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities6, alt: "Famous Performer", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities7, alt: "Star Interaction", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities8, alt: "Celebrity Host", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities9, alt: "VIP Experience", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities10, alt: "Exclusive Event", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities11, alt: "Star Performance", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities12, alt: "Celebrity Guest", width: 800, height: 1000, category: "celebrities" },
  { image: celebrities13, alt: "Famous Attendee", width: 800, height: 1000, category: "celebrities" }
];
---

<section class="gallery-section">
  <div class="container">
    <h2 class="section-title">EXPLORE OUR CASINO</h2>

    <!-- Mobile Dropdown Filter -->
    <div class="category-filter-mobile">
      <select class="category-select" aria-label="Filter gallery">
        {categories.map(category => (
          <option value={category.id}>{category.label}</option>
        ))}
      </select>
    </div>

    <!-- Desktop Filter Buttons -->
    <div class="category-filter">
      {categories.map(category => (
        <button
          class="filter-btn"
          data-category={category.id}
          data-active={category.id === 'all' ? 'true' : 'false'}
        >
          {category.label}
        </button>
      ))}
    </div>

    <div class="gallery-container">
      <div class="gallery-scroll">
        {galleryItems.filter(item => item.image).map(item => (
          <div class="gallery-item" data-category={item.category}>
            <Image
              src={item.image}
              alt={item.alt}
              width={item.width}
              height={item.height}
              quality={80}
              loading="lazy"
              class="gallery-image"
            />
          </div>
        ))}
        <!-- Duplicate items for seamless infinite scroll -->
        {galleryItems.filter(item => item.image).map(item => (
          <div class="gallery-item" data-category={item.category}>
            <Image
              src={item.image}
              alt={item.alt}
              width={item.width}
              height={item.height}
              quality={80}
              loading="lazy"
              class="gallery-image"
            />
          </div>
        ))}
      </div>
    </div>

    <!-- Manual Arrow Navigation -->
    <div class="gallery-navigation">
      <button class="gallery-arrow left arrow-left" aria-label="Slide left">◀</button>
      <button class="gallery-arrow right arrow-right" aria-label="Slide right">▶</button>
    </div>
  </div>
</section>

<!-- Lightbox for full-size image preview -->
<div class="image-lightbox" id="imageLightbox">
  <button class="lightbox-close" aria-label="Close lightbox">&times;</button>
  <button class="lightbox-arrow left" id="prevImage" aria-label="Previous image">◀</button>
  <img src="" alt="" class="lightbox-image" id="lightboxImg">
  <p class="lightbox-caption" id="lightboxCaption"></p>
  <button class="lightbox-arrow right" id="nextImage" aria-label="Next image">▶</button>
</div>

<style>
  .gallery-section {
    padding: 2rem 0;
    background-color: var(--color-bg);
    position: relative;
    overflow: hidden;
  }
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
  }
  .section-title {
    font-size: 2.5rem;
    text-align: center;
    background: linear-gradient(90deg, #e7c980 0%, #9e8253 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 3rem;
    font-weight: 700;
    text-transform: uppercase;
  }
  .category-filter {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 3rem;
    flex-wrap: wrap;
  }
  .filter-btn {
    background: transparent;
    border: none;
    font-size: 1.1rem;
    padding: 0.5rem 1rem;
    cursor: pointer;
    transition: none; /* Remove transition to avoid interference */
    position: relative;
    background: linear-gradient(90deg, #e7c980 0%, #9e8253 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .filter-btn[data-active="true"] {
    background: linear-gradient(90deg, #e7c980 0%, #9e8253 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .filter-btn[data-active="true"]::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 30px;
    height: 2px;
    background: linear-gradient(90deg, #e7c980 0%, #9e8253 100%);
  }
  .filter-btn:hover {
    background: linear-gradient(90deg, #e7c980 0%, #9e8253 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .gallery-container {
    width: 100%;
    overflow: hidden;
    padding: 1rem 0;
    position: relative;
  }
  .gallery-scroll {
    display: flex;
    gap: 1.5rem;
    padding: 0 1rem;
    /* Remove CSS transition for smooth requestAnimationFrame scrolling */
    transition: none;
  }
  .gallery-item {
    width: 200px;
    aspect-ratio: 4/5;
    flex-shrink: 0;
    position: relative;
  }
  @media (max-width: 1024px) {
    .gallery-item {
      width: 350px;
      height: 260px;
    }
  }
  @media (max-width: 768px) {
    .gallery-item {
      width: calc(50vw - 2rem);
      height: auto;
    }
  }
  @media (max-width: 480px) {
    .gallery-item {
      width: calc(85vw - 2rem);
      height: auto;
    }
  }
  .gallery-item.hidden {
    opacity: 0;
    transform: scale(0.95);
    margin: 0 -390px;
    pointer-events: none;
  }
  .gallery-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: none;
  }
  .gallery-item:hover .gallery-image {
    transform: scale(1.05);
  }
  .gallery-item::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(231, 201, 128, 0);
    transition: none;
    border-radius: 12px;
    pointer-events: none;
  }
  .gallery-item:hover::after {
    background: rgba(231, 201, 128, 0.1);
  }
  @media (max-width: 1024px) {
    .section-title {
      font-size: 2.5rem;
    }
    .gallery-item {
      width: 350px;
      height: 260px;
    }
  }
  @media (max-width: 768px) {
    .container {
      padding: 0 1rem;
      width: 95%;
    }
    .section-title {
      font-size: 2rem;
    }
    .filter-btn {
      font-size: 1rem;
      padding: 0.4rem 0.8rem;
    }
    .gallery-item {
      width: 300px;
      height: 225px;
    }
  }
  @media (max-width: 480px) {
    .container {
      width: 98%;
      padding: 0 0.5rem;
    }
    .section-title {
      font-size: 1.8rem;
    }
    .filter-btn {
      font-size: 0.9rem;
      padding: 0.3rem 0.6rem;
    }
    .gallery-item {
      width: 250px;
      height: 190px;
    }
  }
  .category-filter-mobile {
    display: none;
    margin-bottom: 2rem;
  }
  .category-select {
    width: 100%;
    max-width: 300px;
    padding: 0.8rem 1rem;
    border-radius: 8px;
    background: rgba(231, 201, 128, 0.1);
    border: 1px solid rgba(231, 201, 128, 0.3);
    color: #e7c980;
    font-size: 1rem;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23e7c980' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1.2em;
  }
  .category-select:focus {
    outline: none;
    border-color: #e7c980;
  }
  .category-select option {
    background: var(--color-bg);
    color: #e7c980;
    padding: 0.5rem;
  }
  @media (max-width: 768px) {
    .category-filter {
      display: none;
    }
    .category-filter-mobile {
      display: flex;
      justify-content: center;
      padding: 0 1rem;
    }
    .gallery-container {
      padding: 0.5rem 0;
    }
    .gallery-scroll {
      gap: 1rem;
    }
  }
  /* Lightbox styles */
  .image-lightbox {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    z-index: 10000;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    padding: 20px;
  }
  .image-lightbox.active {
    display: flex;
  }
  .lightbox-image {
    max-width: 90%;
    max-height: 80vh;
    object-fit: contain;
    border: 3px solid rgba(231, 201, 128, 0.3);
    border-radius: 8px;
  }
  .lightbox-caption {
    color: #e7c980;
    margin-top: 15px;
    font-size: 18px;
    text-align: center;
  }
  .lightbox-close {
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 40px;
    color: #e7c980;
    background: none;
    border: none;
    cursor: pointer;
    line-height: 1;
  }
  /* Gallery Arrow Navigation */
  .gallery-navigation {
    position: relative;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 1rem;
    z-index: 1000;
  }
  .gallery-arrow {
    background: rgba(0, 0, 0, 0.6);
    color: white;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    font-size: 20px;
    margin: 0 1rem;
    border-radius: 50%;
    transition: background-color 0.3s;
  }
  .gallery-arrow:hover {
    background-color: rgba(231, 201, 128, 0.7);
  }
  /* Lightbox Arrow Navigation */
  .lightbox-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.5);
    color: white;
    border: none;
    font-size: 24px;
    cursor: pointer;
    padding: 10px;
    z-index: 10;
  }
  .lightbox-arrow.left {
    left: 10px;
  }
  .lightbox-arrow.right {
    right: 10px;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // DOM elements
    const filterButtons = document.querySelectorAll('.filter-btn');
    const galleryItems = document.querySelectorAll('.gallery-item');
    const categorySelect = document.querySelector('.category-select');
    const scrollContainer = document.querySelector('.gallery-scroll');

    // Lightbox elements
    const lightbox = document.getElementById("imageLightbox");
    const lightboxImg = document.getElementById("lightboxImg");
    const lightboxCaption = document.getElementById("lightboxCaption");
    const closeButton = document.querySelector(".lightbox-close");
    const prevButton = document.getElementById("prevImage");
    const nextButton = document.getElementById("nextImage");

    // Arrow elements for manual navigation
    const leftArrow = document.querySelector('.arrow-left');
    const rightArrow = document.querySelector('.arrow-right');

    // State variables
    let galleryImages = Array.from(document.querySelectorAll(".gallery-item img"));
    let currentIndex = 0;
    let activeCategory = 'all';

    // Tracking the scroll offset for both auto and manual scrolling
    let currentTranslateX = 0;
    const scrollStep = 300; // pixels per arrow click

    // Auto scroll configuration for 10 seconds to complete one cycle
    let lastTimestamp = null;
    const durationMs = 80000; // 15 seconds
    const resetThreshold = scrollContainer.scrollWidth / 2; // because items are duplicated
    const pixelsPerMs = resetThreshold / durationMs;

    // Flag to pause scrolling on hover
    let isPaused = false;
    scrollContainer.addEventListener("mouseenter", () => {
      isPaused = true;
    });
    scrollContainer.addEventListener("mouseleave", () => {
      isPaused = false;
    });

    function animateScroll(timestamp) {
      if (isPaused) {
        lastTimestamp = timestamp; // reset timestamp to prevent jump on resume
        requestAnimationFrame(animateScroll);
        return;
      }
      if (!lastTimestamp) lastTimestamp = timestamp;
      const deltaTime = timestamp - lastTimestamp;
      currentTranslateX += pixelsPerMs * deltaTime;
      if (currentTranslateX >= resetThreshold) {
        currentTranslateX = 0;
      }
      scrollContainer.style.transform = `translateX(-${currentTranslateX}px)`;
      lastTimestamp = timestamp;
      requestAnimationFrame(animateScroll);
    }

    requestAnimationFrame(animateScroll);

    // Manual arrow navigation
    leftArrow.addEventListener('click', () => {
      currentTranslateX -= scrollStep;
      if (currentTranslateX < 0) {
        currentTranslateX = resetThreshold - 1;
      }
      scrollContainer.style.transform = `translateX(-${currentTranslateX}px)`;
    });

    rightArrow.addEventListener('click', () => {
      currentTranslateX += scrollStep;
      if (currentTranslateX >= resetThreshold) {
        currentTranslateX = 0;
      }
      scrollContainer.style.transform = `translateX(-${currentTranslateX}px)`;
    });

    // Filter gallery function
    function updateFilterUI(category) {
      filterButtons.forEach(btn => {
        btn.setAttribute('data-active', btn.getAttribute('data-category') === category ? 'true' : 'false');
      });
      if (categorySelect) {
        categorySelect.value = category;
      }
    }
    function filterGallery(selectedCategory) {
      activeCategory = selectedCategory;
      updateFilterUI(selectedCategory);
      galleryItems.forEach(item => {
        item.style.display = (selectedCategory !== 'all' && item.dataset.category !== selectedCategory)
          ? 'none'
          : 'block';
      });
      // Reset scroll position after filtering
      currentTranslateX = 0;
      scrollContainer.style.transform = `translateX(-${currentTranslateX}px)`;
      updateGalleryImagesArray();
    }
    function updateGalleryImagesArray() {
      galleryImages = Array.from(
        document.querySelectorAll(
          `.gallery-item${activeCategory !== 'all' ? `[data-category="${activeCategory}"]` : ''} img`
        )
      );
      currentIndex = Math.max(0, Math.min(currentIndex, galleryImages.length - 1));
    }

    // Filter button events
    filterButtons.forEach(button => {
      button.addEventListener('click', () => {
        filterGallery(button.getAttribute('data-category'));
      });
    });
    // Category select event for mobile
    if (categorySelect) {
      categorySelect.addEventListener('change', (e) => {
        filterGallery(e.target.value);
      });
    }

    // Lightbox functions
    function updateLightbox() {
      if (currentIndex >= 0 && currentIndex < galleryImages.length) {
        const img = galleryImages[currentIndex];
        lightboxImg.src = img.src;
        lightboxImg.alt = img.alt;
        lightboxCaption.textContent = img.alt || "Image";
      }
    }
    function openLightbox(index) {
      currentIndex = index;
      updateLightbox();
      lightbox.classList.add("active");
      document.body.style.overflow = 'hidden';
    }
    function closeLightbox() {
      lightbox.classList.remove("active");
      document.body.style.overflow = '';
    }
    function navigateLightbox(direction) {
      currentIndex = direction === 'prev'
        ? (currentIndex - 1 + galleryImages.length) % galleryImages.length
        : (currentIndex + 1) % galleryImages.length;
      updateLightbox();
    }
    // Gallery item click events for lightbox
    document.querySelectorAll('.gallery-item').forEach(item => {
      item.addEventListener('click', function() {
        const clickedImg = this.querySelector('img');
        const imgIndex = galleryImages.findIndex(img => img === clickedImg);
        if (imgIndex >= 0) openLightbox(imgIndex);
      });
    });
    // Lightbox controls
    closeButton.addEventListener('click', closeLightbox);
    prevButton.addEventListener('click', () => navigateLightbox('prev'));
    nextButton.addEventListener('click', () => navigateLightbox('next'));
    lightbox.addEventListener('click', function(e) {
      if (e.target === lightbox) closeLightbox();
    });
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && lightbox.classList.contains('active')) {
        closeLightbox();
      }
    });
  });
</script>
