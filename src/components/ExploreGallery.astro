---
/* src/components/ExploreCasinoGallery.astro */
import { Image } from 'astro:assets';

import amenity1 from "../assets/gallery/amenities/1.jpg";
import amenity2 from "../assets/gallery/amenities/2.jpg";
import amenity3 from "../assets/gallery/amenities/3.jpg";
import amenity4 from "../assets/gallery/amenities/4.jpg";

import gaming1  from "../assets/gallery/gaming/1.jpg";
import gaming2  from "../assets/gallery/gaming/2.jpg";
import gaming3  from "../assets/gallery/gaming/3.jpg";
import gaming4  from "../assets/gallery/gaming/4.jpg";
import gaming5  from "../assets/gallery/gaming/5.jpg";

import entertainment1 from "../assets/gallery/entertainment/1.jpg";
import entertainment2 from "../assets/gallery/entertainment/2.jpg";
import entertainment3 from "../assets/gallery/entertainment/3.jpg";
import entertainment4 from "../assets/gallery/entertainment/4.jpg";
import entertainment5 from "../assets/gallery/entertainment/5.jpg";

import ambiance1 from "../assets/gallery/ambiance/1.jpg";
import ambiance2 from "../assets/gallery/ambiance/2.jpg";
import ambiance3 from "../assets/gallery/ambiance/3.jpg";
import ambiance4 from "../assets/gallery/ambiance/4.jpg";

import food1  from "../assets/gallery/food-and-drinks/1.jpg";
import food2  from "../assets/gallery/food-and-drinks/2.jpg";
import food3  from "../assets/gallery/food-and-drinks/3.jpg";
import food4  from "../assets/gallery/food-and-drinks/4.jpg";
import food5  from "../assets/gallery/food-and-drinks/5.jpg";
import food6  from "../assets/gallery/food-and-drinks/6.jpg";
import food7  from "../assets/gallery/food-and-drinks/7.jpg";

import celebrities1  from "../assets/gallery/celebrities/1.jpg";
import celebrities2  from "../assets/gallery/celebrities/2.jpg";
import celebrities3  from "../assets/gallery/celebrities/3.jpg";
import celebrities4  from "../assets/gallery/celebrities/4.jpg";
import celebrities5  from "../assets/gallery/celebrities/5.jpg";
import celebrities6  from "../assets/gallery/celebrities/6.jpg";
import celebrities7  from "../assets/gallery/celebrities/7.jpg";
import celebrities8  from "../assets/gallery/celebrities/8.jpg";
import celebrities9  from "../assets/gallery/celebrities/9.jpg";
import celebrities10 from "../assets/gallery/celebrities/10.jpg";
import celebrities11 from "../assets/gallery/celebrities/11.jpg";
import celebrities12 from "../assets/gallery/celebrities/12.jpg";
import celebrities13 from "../assets/gallery/celebrities/13.jpg";

const items = [
  { src: amenity1,    category: "amenities" },
  { src: amenity2,    category: "amenities" },
  { src: amenity3,    category: "amenities" },
  { src: amenity4,    category: "amenities" },
  { src: gaming1,     category: "gaming"    },
  { src: gaming2,     category: "gaming"    },
  { src: gaming3,     category: "gaming"    },
  { src: gaming4,     category: "gaming"    },
  { src: gaming5,     category: "gaming"    },
  { src: entertainment1, category: "entertainment" },
  { src: entertainment2, category: "entertainment" },
  { src: entertainment3, category: "entertainment" },
  { src: entertainment4, category: "entertainment" },
  { src: entertainment5, category: "entertainment" },
  { src: ambiance1,   category: "ambiance"  },
  { src: ambiance2,   category: "ambiance"  },
  { src: ambiance3,   category: "ambiance"  },
  { src: ambiance4,   category: "ambiance"  },
  { src: food1,       category: "food"      },
  { src: food2,       category: "food"      },
  { src: food3,       category: "food"      },
  { src: food4,       category: "food"      },
  { src: food5,       category: "food"      },
  { src: food6,       category: "food"      },
  { src: food7,       category: "food"      },
  { src: celebrities1,  category: "celebrities" },
  { src: celebrities2,  category: "celebrities" },
  { src: celebrities3,  category: "celebrities" },
  { src: celebrities4,  category: "celebrities" },
  { src: celebrities5,  category: "celebrities" },
  { src: celebrities6,  category: "celebrities" },
  { src: celebrities7,  category: "celebrities" },
  { src: celebrities8,  category: "celebrities" },
  { src: celebrities9,  category: "celebrities" },
  { src: celebrities10, category: "celebrities" },
  { src: celebrities11, category: "celebrities" },
  { src: celebrities12, category: "celebrities" },
  { src: celebrities13, category: "celebrities" },
];
---

<section class="gallery-section">
  <h2 class="section-title">EXPLORE OUR CASINO</h2>

  <div class="category-filter">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="amenities">Amenities</button>
    <button class="filter-btn" data-filter="gaming">Gaming</button>
    <button class="filter-btn" data-filter="entertainment">Entertainment</button>
    <button class="filter-btn" data-filter="ambiance">Ambiance</button>
    <button class="filter-btn" data-filter="food">Food</button>
    <button class="filter-btn" data-filter="celebrities">Celebrities</button>
  </div>

  <div class="gallery-wrapper">
    <button class="gallery-arrow left" aria-label="Previous">❮</button>
    <div class="gallery-scroll" data-filter="all">
      {items.map((item, i) => (
        <div class="gallery-item" data-category={item.category} key={`dup1-${i}`}>
          <Image src={item.src} alt="" width={800} height={1000} class="gallery-image" loading="lazy" />
        </div>
      ))}
      {items.map((item, i) => (
        <div class="gallery-item" data-category={item.category} key={`dup2-${i}`}>
          <Image src={item.src} alt="" width={800} height={1000} class="gallery-image" loading="lazy" />
        </div>
      ))}
    </div>
    <button class="gallery-arrow right" aria-label="Next">❯</button>
  </div>
</section>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <button class="lightbox-close" aria-label="Close">&times;</button>
  <button class="lightbox-arrow left" aria-label="Previous">❮</button>
  <img class="lightbox-image" src="" alt="">
  <button class="lightbox-arrow right" aria-label="Next">❯</button>
</div>

<style>
  .gallery-section { padding: 2rem 0; background: var(--color-bg); }
  .section-title {
    text-align: center; font-size: 2.5rem; margin-bottom:1.5rem;
    background: linear-gradient(90deg,#e7c980,#9e8253);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }

  .category-filter {
    display:flex; justify-content:center; gap:1rem; margin-bottom:1.5rem;
  }
  .filter-btn {
    background:transparent; border:none; padding:.5rem 1rem;
    font-size:1rem; cursor:pointer; color:#e7c980; opacity:.6;
    transition:opacity .2s;
  }
  .filter-btn.active, .filter-btn:hover { opacity:1; }

  .gallery-wrapper { position:relative; overflow:hidden; }
  .gallery-scroll {
    display:flex; gap:1rem; width:max-content;
    /* no animation here—set via JS */
    will-change:transform;
  }
  @keyframes scrollGallery { 0%{transform:translateX(0);} 100%{transform:translateX(-50%);} }
  .gallery-scroll:hover { animation-play-state:paused; }

  /* filters */
  .gallery-scroll[data-filter="all"] .gallery-item { display:block; }
  .gallery-scroll[data-filter="amenities"]    .gallery-item:not([data-category="amenities"])    { display:none; }
  .gallery-scroll[data-filter="gaming"]       .gallery-item:not([data-category="gaming"])       { display:none; }
  .gallery-scroll[data-filter="entertainment"] .gallery-item:not([data-category="entertainment"]) { display:none; }
  .gallery-scroll[data-filter="ambiance"]     .gallery-item:not([data-category="ambiance"])     { display:none; }
  .gallery-scroll[data-filter="food"]         .gallery-item:not([data-category="food"])         { display:none; }
  .gallery-scroll[data-filter="celebrities"]  .gallery-item:not([data-category="celebrities"])  { display:none; }

  .gallery-item { flex:0 0 auto; width:200px; aspect-ratio:4/5; cursor:pointer; }
  .gallery-image { width:100%; height:100%; object-fit:cover; border-radius:8px; }

  .gallery-arrow {
    position:absolute; top:50%; transform:translateY(-50%);
    background:rgba(0,0,0,0.5); color:#fff; border:none;
    width:2.5rem;height:2.5rem;border-radius:50%;cursor:pointer;
    z-index:10; display:flex;align-items:center;justify-content:center;
  }
  .gallery-arrow.left  { left:1rem; }
  .gallery-arrow.right { right:1rem; }

  /* Lightbox */
  .lightbox {
    display:none; position:fixed; inset:0;
    background:rgba(0,0,0,0.8); z-index:10000;
    align-items:center; justify-content:center;
  }
  .lightbox.active { display:flex; }
  .lightbox-image {
    max-width:90%; max-height:80vh; object-fit:contain;
    border:3px solid rgba(231,201,128,0.3); border-radius:8px;
  }
  .lightbox-close {
    position:absolute; top:1rem; right:1rem;
    background:none; border:none; font-size:2.5rem; color:#e7c980; cursor:pointer;
  }
  .lightbox-arrow {
    position:absolute; top:50%; transform:translateY(-50%);
    background:rgba(0,0,0,0.5); color:#fff; border:none;
    width:2.5rem;height:2.5rem;border-radius:50%;cursor:pointer;
    z-index:10001;display:flex;align-items:center;justify-content:center;
  }
  .lightbox-arrow.left  { left:2rem; }
  .lightbox-arrow.right { right:2rem; }

  @media(max-width:768px){ .gallery-item{width:150px;} }
</style>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    const scrollEl   = document.querySelector('.gallery-scroll');
    const firstItem  = scrollEl.querySelector('.gallery-item');
    const gap        = parseInt(getComputedStyle(firstItem).marginRight) || 0;
    const step       = firstItem.clientWidth + gap;
    const arrows     = document.querySelectorAll('.gallery-arrow');
    const filters    = document.querySelectorAll('.filter-btn');
    const baseDur    = 40; // seconds
    const initHalf   = scrollEl.scrollWidth / 2;

    // initialize marquee inline
    scrollEl.style.animation = `scrollGallery ${baseDur}s linear infinite`;
    scrollEl.style.animationDelay = `0s`;

    function jump(dir) {
      scrollEl.style.animationPlayState = 'paused';
      // current X
      const matrix = getComputedStyle(scrollEl).transform;
      let curX = 0;
      if (matrix && matrix.startsWith('matrix')) {
        const vals = matrix.slice(7, -1).split(', ');
        curX = parseFloat(vals[4]);
      }
      const newX = curX - dir * step * 3;
      scrollEl.style.transform = `translateX(${newX}px)`;

      // recalc new duration
      const newHalf = scrollEl.scrollWidth / 2;
      const newDur  = (newHalf * baseDur) / initHalf;
      scrollEl.style.animation = `scrollGallery ${newDur}s linear infinite`;
      // compute delay for continuity
      const off  = ((newX % -newHalf) + -newHalf) % -newHalf;
      const frac = off / -newHalf;
      scrollEl.style.animationDelay = `-${frac * newDur}s`;
    }

    arrows.forEach(btn =>
      btn.addEventListener('click', () =>
        jump(btn.classList.contains('right') ? 1 : -1)
      )
    );
    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
        e.preventDefault();
        jump(e.key === 'ArrowRight' ? 1 : -1);
      }
    });

    filters.forEach(btn => {
      btn.addEventListener('click', () => {
        filters.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const cat = btn.dataset.filter;
        scrollEl.setAttribute('data-filter', cat);

        // re-init marquee so speed stays constant
        const newHalf2 = scrollEl.scrollWidth / 2;
        const newDur2  = (newHalf2 * baseDur) / initHalf;
        scrollEl.style.animation = `scrollGallery ${newDur2}s linear infinite`;
        scrollEl.style.animationDelay = '0s';
      });
    });

    // Lightbox setup
    const lb       = document.getElementById('lightbox');
    const lbImg    = lb.querySelector('.lightbox-image');
    const lbClose  = lb.querySelector('.lightbox-close');
    const lbPrev   = lb.querySelector('.lightbox-arrow.left');
    const lbNext   = lb.querySelector('.lightbox-arrow.right');
    // collect unique srcs
    const allImgs  = Array.from(document.querySelectorAll('.gallery-item img')).map(i => i.src);
    const imgs     = allImgs.slice(0, allImgs.length / 2);
    let idx = 0;

    document.querySelectorAll('.gallery-item').forEach((el, i) => {
      el.addEventListener('click', () => {
        idx = i % imgs.length;
        lbImg.src = imgs[idx];
        lb.classList.add('active');
        document.body.style.overflow = 'hidden';
      });
    });
    lbClose.addEventListener('click', () => {
      lb.classList.remove('active');
      document.body.style.overflow = '';
    });
    lbPrev.addEventListener('click', () => {
      idx = (idx - 1 + imgs.length) % imgs.length;
      lbImg.src = imgs[idx];
    });
    lbNext.addEventListener('click', () => {
      idx = (idx + 1) % imgs.length;
      lbImg.src = imgs[idx];
    });
    lb.addEventListener('click', e => {
      if (e.target === lb) lbClose.click();
    });
    document.addEventListener('keydown', e => {
      if (lb.classList.contains('active')) {
        if (e.key === 'ArrowLeft') lbPrev.click();
        if (e.key === 'ArrowRight') lbNext.click();
        if (e.key === 'Escape') lbClose.click();
      }
    });
  });
</script>
